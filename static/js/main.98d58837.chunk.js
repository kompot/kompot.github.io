(this["webpackJsonpfintrack-client-only"]=this["webpackJsonpfintrack-client-only"]||[]).push([[0],{235:function(e,t,a){e.exports=a(253)},240:function(e,t,a){},241:function(e,t,a){},246:function(e,t,a){},253:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),l=a(41),i=a.n(l),o=(a(240),a(51)),c=a(58),u=a(33),d=a(110),s=a(325),m=(a(241),a(48)),v=a(83),E=a(198),f=a(29),p=a(158),b=a(220),g=a(193),y=a.n(g),h=a(194),A=a.n(h),S=Object(E.a)({id:"fetch",initial:"idle",context:{url:"",data:null,error:null,retries:0,maxRetries:3},states:{idle:{on:{FETCH:"loading"}},loading:{invoke:{src:"fetch",onDone:{target:"success",actions:["setData","notifyData",Object(f.r)("LOADED")]},onError:{target:"failure",actions:["setError","notifyError"]}}},success:{on:{REFETCH:{target:"loading",actions:"resetRetries"}}},failure:{on:{"":{target:"fatal",cond:"canNotRetry"},RETRY:{target:"loading",actions:"incrementRetries"}}},fatal:{type:"final"}}},{guards:{canNotRetry:function(e){return e.retries===e.maxRetries}},actions:{setData:Object(f.b)({data:function(e,t){return t.data}}),notifyData:function(){console.log("-----notifydata")},setError:Object(f.b)({error:function(e,t){return t.data}}),notifyError:function(){},incrementRetries:Object(f.b)({retries:function(e){return e.retries+1}})},services:{fetch:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return fetch(e.url).then((function(e){return e.json()})).then((function(e){return e}))}))}}),O=Object(b.a)("ABCDEFGHJKLMNPQRSTUVWXYZ123456789",6),I=function(e){var t=new Date(e);return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())},x=Object(E.a)({key:"store",initial:"idle",context:{db:null,urlDataToSave:void 0,fetchRef:null},entry:Object(f.b)({fetchRef:function(){return Object(p.c)(S.withContext({url:"/data.json",maxRetries:4,data:null,error:null,retries:0}),{name:"fetch"})}}),states:{idle:{entry:Object(f.b)((function(e,t){if(null!==e.db)return{};var a=null!==sessionStorage.getItem("fintrack_db")?JSON.parse(sessionStorage.getItem("fintrack_db")):null,n=y()(new A.a(""));return n.setState(a),{db:n}})),on:{LOAD:{actions:Object(f.q)("FETCH",{to:"fetch"})},LOADED:"loaded",UPDATE_DATA:"updating_data",LOAD_FROM_INPUT:"loaded_from_input"}},loaded:{entry:Object(f.b)((function(e,t){void 0!==e.urlDataToSave&&window.URL.revokeObjectURL(e.urlDataToSave);var a=y()(new A.a(""));return a.setState(e.fetchRef._state.context.data),{db:a,urlDataToSave:void 0}})),on:{SAVE:"saving",UPDATE_DATA:"updating_data"}},loaded_from_input:{entry:Object(f.b)((function(e,t){console.log("=========loaded_from_input",t);var a=y()(new A.a(""));return a.setState(t.data),sessionStorage.setItem("fintrack_db",JSON.stringify(t.data)),{db:a,urlDataToSave:void 0}})),on:{SAVE:"saving",UPDATE_DATA:"updating_data",LOAD_FROM_INPUT:"loaded_from_input"}},saving:{entry:Object(f.b)((function(e,t){var a,n;return console.log("-=====ctx.data",null===(a=e.db)||void 0===a?void 0:a.getState()),{urlDataToSave:window.URL.createObjectURL(new Blob([JSON.stringify(null===(n=e.db)||void 0===n?void 0:n.getState(),null,2)],{type:"text/plain"}))}})),on:{SAVED:"loaded"}},updating_data:{entry:Object(f.b)((function(e,t){var a;if("create"===t.actionType)if("assetAccountStates"===t.entity){var n,r=O();null===(n=e.db)||void 0===n||n.get("data").get("reports").push({id:r,datetime:I(t.data.date)}).write(),t.data.assetAccountStates.forEach((function(t){var a;null===(a=e.db)||void 0===a||a.get("data").get("assetAccountStates").push(Object(v.a)(Object(v.a)({},t),{},{reportId:r})).write()}))}else{var l,i;null===(l=e.db)||void 0===l||null===(i=l.get("data"))||void 0===i||i.get(t.entity).push(Object(v.a)({id:O()},t.data)).write()}else if("update"===t.actionType){if("exchangeRates"===t.entity){var o,c=null===(o=e.db)||void 0===o?void 0:o.get("data").get("exchangeRates"),u=null===c||void 0===c?void 0:c.find((function(e){return e.reportId===t.data.report.id}));if(void 0!==(null===u||void 0===u?void 0:u.value()))u.get("data").set(t.data.asset.id,t.data.value).write();else{var d={id:O(),reportId:t.data.report.id,data:Object(m.a)({},t.data.asset.id,t.data.value)};null===c||void 0===c||c.push(d).write()}}if("assetAccountStates"===t.entity){var s,E,f=null===(s=e.db)||void 0===s?void 0:s.get("data").get("reports"),p=null===f||void 0===f?void 0:f.find((function(e){return e.id===t.data.reportId}));null===p||void 0===p||p.set("datetime",I(t.data.date)).write();var b=[];null===(E=e.db)||void 0===E||E.get("data").get("assetAccountStates").forEach((function(e){var a;e.reportId===t.data.reportId&&(e.balance=null===(a=t.data.assetAccountStates.find((function(t){return t.assetAccountId===e.assetAccountId})))||void 0===a?void 0:a.balance,b.push(e.assetAccountId))})).write(),t.data.assetAccountStates.filter((function(e){return!b.includes(e.assetAccountId)})).forEach((function(a){var n;null===(n=e.db)||void 0===n||n.get("data").get("assetAccountStates").push(Object(v.a)(Object(v.a)({},a),{},{reportId:t.data.reportId})).write()}))}if("institutions"===t.entity){var g,y=null===(g=e.db)||void 0===g?void 0:g.get("data").get("institutions"),h=null===y||void 0===y?void 0:y.find((function(e){return e.id===t.data.id}));null===h||void 0===h||h.assign(t.data).write()}}else{if("delete"!==t.actionType)throw new Error("How did you end up here?");var A,S,x,T,j,_;"institutions"===t.entity&&(null===(A=e.db)||void 0===A||A.get("data").get("institutions").remove((function(e){return e.id===t.data.id})).write());"assets"===t.entity&&(null===(S=e.db)||void 0===S||S.get("data").get("assets").remove((function(e){return e.id===t.data.id})).write());"assetAccounts"===t.entity&&(null===(x=e.db)||void 0===x||x.get("data").get("assetAccounts").remove((function(e){return e.id===t.data.id})).write());"reports"===t.entity&&(null===(T=e.db)||void 0===T||T.get("data").get("reports").remove((function(e){return e.id===t.data.id})).write(),null===(j=e.db)||void 0===j||j.get("data").get("assetAccountStates").remove((function(e){return e.reportId===t.data.id})).write(),null===(_=e.db)||void 0===_||_.get("data").get("exchangeRates").remove((function(e){return e.reportId===t.data.id})).write())}return sessionStorage.setItem("fintrack_db",JSON.stringify(null===(a=e.db)||void 0===a?void 0:a.getState())),{}})),on:{"":"idle"}}}}),T=a(74),j=a.n(T),_=a(90),D=a(76),R=a(221),w=a(301),U=a(304),k=a(307),C=a(305),F=a(306),B=(a(246),function(e){var t=e.children;return(r.a.createElement("table",{className:"_3-1r7"},t))}),N=function(e){var t=e.children;return(r.a.createElement("tr",{className:"_3Mjlo"},t))},q=function(e){var t=e.children,a=e.colspan;return(r.a.createElement("td",{className:"zX0YF",colSpan:a},t))},M=function(e){var t=e.children,a=e.colspan;return(r.a.createElement("th",{className:"_1rfFa",colSpan:a},t))},P=a(59),L=["CURRENCY","CRYPTO_CURRENCY","SECURITY","VALUABLE_ASSET","PRECIOUS_METAL"],Y=["BANK","BROKER","PERSON","PHYSICAL_LOCATION","E-WALLET","OTHER"],V=[2,",","."],W=a(247);function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V,n="number"===typeof e?e:parseFloat(e);return W.formatMoney.apply(W,[n,t].concat(Object(P.a)(a)))}function X(e,t,a,n){return null===e||void 0===e?void 0:e.data.assetAccountStates.filter((function(e){return e.reportId===t.id})).reduce((function(r,l){var i,o=e.data.assetAccounts.find((function(e){return e.id===l.assetAccountId})),c=e.data.assets.find((function(e){return e.id===o.assetId}));if(void 0!==n&&!n(c))return r;var u=null===(i=e.data.exchangeRates.find((function(e){return e.reportId===t.id})))||void 0===i?void 0:i.data;return function(e,t,a,n){if(void 0===t)return 0;var r="CURRENCY"===a.class,l=r?a:null===e||void 0===e?void 0:e.data.assets.find((function(e){return"CURRENCY"===e.class&&e.name===a.currency})),i=1;if(l.currency!==n){var o=null===e||void 0===e?void 0:e.data.assets.find((function(e){return"CURRENCY"===e.class&&e.name===n}));if(void 0!==o){var c=t[o.id];i=null!==c?parseFloat(c):0}}return 0===i?0:parseFloat(t[l.id]||"0")/i*(r?1:parseFloat(t[a.id]||"0"))}(e,u,c,a)*parseFloat(l.balance)+r}),0)}function J(e){return j.a.sortBy(null===e||void 0===e?void 0:e.data.institutions,(function(e){return e.sortIndex}))}function H(e){var t;return null===(t=J(e))||void 0===t?void 0:t.flatMap((function(t){return j.a.sortBy(null===e||void 0===e?void 0:e.data.assetAccounts.filter((function(e){return e.institutionId===t.id})),(function(e){return e.name}))}))}var K=function(e){var t,a=Object(n.useContext)($e),l=H(a);if(void 0===l)return null;var i=j.a.sortBy(null===a||void 0===a?void 0:a.data.reports,(function(e){return-1*e.datetime})),o=null===a||void 0===a?void 0:a.data.assets;i[0];return r.a.createElement("div",null,r.a.createElement("h1",null,"Your net worth is..."),r.a.createElement(w.a,{color:"primary","aria-label":"add",component:c.b,to:"add-edit-report",style:{margin:0,top:"auto",right:20,bottom:80,left:"auto",position:"fixed"}},r.a.createElement(U.a,null)),r.a.createElement(B,null,r.a.createElement("thead",null,r.a.createElement(N,null,r.a.createElement(M,null),null===(t=J(a))||void 0===t?void 0:t.map((function(e){return r.a.createElement(M,{key:e.id,colspan:l.filter((function(t){return t.institutionId===e.id})).length},e.name)}))),r.a.createElement(N,null,r.a.createElement(M,null,"date"),l.map((function(e){return r.a.createElement(M,null,e.name)})),r.a.createElement(M,null,"Total in RUB"),r.a.createElement(M,null,"Total in USD"),r.a.createElement(M,null,"Total in EUR"))),r.a.createElement("tbody",null,null===i||void 0===i?void 0:i.map((function(t){var n=null===a||void 0===a?void 0:a.data.assetAccountStates.filter((function(e){return e.reportId===t.id}));return(r.a.createElement(N,{key:t.id},r.a.createElement(q,null,r.a.createElement(C.a,{variant:"outlined",size:"small",color:"primary",component:c.b,to:"add-edit-report/".concat(t.id)},new Date(t.datetime).toISOString().substr(0,10))),l.map((function(e){var t=null===n||void 0===n?void 0:n.find((function(t){return t.assetAccountId===e.id}));return(r.a.createElement(q,null,z((null===t||void 0===t?void 0:t.balance)||"0")))})),r.a.createElement(q,null,z(X(a,t,"RUB")||0)),r.a.createElement(q,null,z(X(a,t,"USD")||0)),r.a.createElement(q,null,z(X(a,t,"EUR")||0)),r.a.createElement(q,null,r.a.createElement(F.a,{color:"secondary",size:"small",onClick:function(){return a=t.id,void e.storeService.send("UPDATE_DATA",{actionType:"delete",entity:"reports",data:{id:a}});var a}},r.a.createElement(k.a,null)))))})))),r.a.createElement("h2",null,"Exchange rates"),r.a.createElement(B,null,r.a.createElement("thead",null,r.a.createElement(N,null,r.a.createElement(M,null,"date"),null===o||void 0===o?void 0:o.map((function(e){return r.a.createElement(M,null,e.class," ",e.subclass," ",e.name," in ",e.currency)})))),r.a.createElement("tbody",null,null===i||void 0===i?void 0:i.map((function(t){var n=null===a||void 0===a?void 0:a.data.exchangeRates.find((function(e){return e.reportId===t.id}));return(r.a.createElement(N,{key:t.id},r.a.createElement(q,null,new Date(t.datetime).toISOString().substr(0,10)),null===o||void 0===o?void 0:o.map((function(a){var l,i=null===n||void 0===n?void 0:null===(l=n.data)||void 0===l?void 0:l[a.id];return r.a.createElement(q,null,r.a.createElement("input",{style:{width:50},defaultValue:i,onChange:function(n){return function(t,a,n){console.log("_________value",t,a,n),e.storeService.send({type:"UPDATE_DATA",actionType:"update",entity:"exchangeRates",data:{value:t,asset:a,report:n}})}(n.target.value,a,t)}}))}))))})))))};_.d(R.a);var G=function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.paddingRight=20;var t=e.xAxes.push(new D.b);t.renderer.grid.template.location=0,t.renderer.minGridDistance=50,t.dateFormats.setKey("day","MMMM dt"),t.dateFormats.setKey("month","MMM yyyy"),t.periodChangeDateFormats.setKey("month","[bold]MMM yyyy"),t.renderer.axisFills.template.disabled=!1,t.renderer.axisFills.template.fill=_.a("#1AB0F1"),t.renderer.axisFills.template.fillOpacity=.1;var a=e.yAxes.push(new D.g);a.renderer.minWidth=35;var n=new D.j;n.xAxis=t,n.fullWidthLineX=!0,n.lineX.strokeWidth=0,n.lineX.fill=_.a("#8F3985"),n.lineX.fillOpacity=.1,e.cursor=n;var r=new D.i;e.scrollbarX=r,e.legend=new D.c},Q=function(){var e=Object(n.useContext)($e),t=null===e||void 0===e?void 0:e.data.reports;var a=["USD","EUR","RUB"].map((function(a){var n=j.a.compact(null===t||void 0===t?void 0:t.map((function(t){return{date:new Date(t.datetime),value:parseFloat((X(e,t,a,(function(e){return e.name===a}))||0).toFixed(0))}})));return{currency:a,points:n||[]}}));return Object(n.useEffect)((function(){var e=function(e){var t=_.b("total_by_currencies_chart",D.h);return G(t),j.a.map(e,(function(e){var a=t.series.push(new D.d);return a.data=e.points,a.dataFields.dateX="date",a.dataFields.valueY="value",a.name=e.currency,a.strokeWidth=3,a.tooltipText="{valueY.value} ({valueY.change})",a.bullets.push(new D.a),a})),t}(a);return function(){e.dispose()}})),r.a.createElement("div",{id:"total_by_currencies_chart",style:{width:"100%",height:"500px",marginBottom:"100px"}})},Z=function(e){var t=Object(n.useContext)($e),a=null===t||void 0===t?void 0:t.data.reports;var l=["USD","EUR","RUB"].map((function(e){var n=j.a.compact(null===a||void 0===a?void 0:a.map((function(a){return{date:new Date(a.datetime),value:parseFloat((X(t,a,e)||0).toFixed(0))}})));return{currency:e,points:n||[]}}));return Object(n.useEffect)((function(){var t=function(t){var a=_.b("total_in_currencies_chart",D.h);return G(a,!e.stacked),j.a.map(t,(function(n,r){var l=a.series.push(new D.d);if(l.data=n.points,l.dataFields.dateX="date",l.dataFields.valueY="value",l.name=n.currency,l.strokeWidth=3,l.tooltipText="{valueY.value} ({valueY.change})",l.bullets.push(new D.a),e.stacked){var i=a.yAxes.push(new D.g);l.yAxis=i,i.renderer.line.strokeOpacity=1,i.renderer.line.stroke=l.stroke,i.renderer.grid.template.stroke=l.stroke,i.renderer.grid.template.strokeOpacity=.1,i.renderer.labels.template.fill=l.stroke,i.renderer.minGridDistance=20,i.align="right",0===r?i.marginBottom=20:r===t.length-1?i.marginTop=20:(i.marginTop=10,i.marginBottom=10)}return l})),e.stacked&&(a.leftAxesContainer.layout="vertical"),a}(l);return function(){t.dispose()}})),r.a.createElement("div",{id:"total_in_currencies_chart",style:{width:"100%",height:"500px",marginBottom:"100px"}})},$=function(){var e="total_cash_distribution_by_currency_chart",t=Object(n.useContext)($e);null===t||void 0===t||t.data.reports;var a=j.a.maxBy(null===t||void 0===t?void 0:t.data.reports,(function(e){return e.datetime})),l=[];return a&&(l=["USD","EUR","RUB"].map((function(e){return{currency:e,totalInUSD:X(t,a,"USD",(function(t){return"CURRENCY"===t.class&&t.name===e}))||0}}))),console.log(l),Object(n.useEffect)((function(){var t=function(t){var a=_.b(e,D.e);a.data=t,a.innerRadius=_.c(30);var n=a.series.push(new D.f);return n.dataFields.value="totalInUSD",n.dataFields.category="currency",n.ticks.template.disabled=!0,n.slices.template.strokeWidth=2,n.slices.template.stroke=_.a("#000"),n.slices.template.tooltipText="{value.value.formatNumber('#,###.')} USD",n.alignLabels=!1,n.labels.template.text="{category}: {value.percent.formatNumber('#.0')}%",n.labels.template.radius=_.c(-35),n.labels.template.fill=_.a("white"),a}(l);return function(){t.dispose()}})),r.a.createElement("div",{id:e,style:{width:"100%",height:"500px",marginBottom:"100px"}})},ee=function(){Object(n.useContext)($e);return(r.a.createElement("div",{style:{height:300}},r.a.createElement("h1",null,"Charts"),r.a.createElement("div",{style:{width:"100%",height:300,display:"flex"}},r.a.createElement("div",{style:{width:"50%",height:300}},r.a.createElement("h3",null,"Total by currency"),r.a.createElement(Q,null)),r.a.createElement("div",{style:{width:"50%",height:300}},r.a.createElement("h3",null,"Total in currency"),r.a.createElement(Z,{stacked:!1}))),r.a.createElement("div",{style:{width:"100%",height:"300px",marginTop:"300px",marginBottom:"50px"}},r.a.createElement("div",{style:{width:"50%",height:"300px"}},r.a.createElement("h3",null,"Cash distribution by currency"),r.a.createElement($,null)))))},te=a(310),ae=a(311),ne=a(209),re=a.n(ne),le=a(210),ie=a.n(le),oe=a(211),ce=a.n(oe),ue=a(308),de=a(330),se=a(309),me=Object(ue.a)((function(e){return Object(de.a)({text:{padding:e.spacing(2,2,0)},paper:{paddingBottom:50},list:{marginBottom:e.spacing(2)},subheader:{backgroundColor:e.palette.background.paper},appBar:{top:"auto",bottom:0},grow:{flexGrow:1},fabButton:{position:"absolute",zIndex:1,top:-30,left:0,right:0,margin:"0 auto"},fullList:{width:"auto"}})})),ve=j.a.values({0:"/",1:"/assets-and-reports",2:"/import-export"}),Ee=function(e,t){return"/"===e?"/"===t:t.startsWith(e)},fe=function(){var e=me(),t=Object(u.f)(),a=r.a.useState(void 0),l=Object(o.a)(a,2),i=l[0],d=l[1];return Object(n.useEffect)((function(){ve.some((function(e){return Ee(e,t.pathname)}))||d(void 0);var e=ve.findIndex((function(e){return Ee(e,t.pathname)}));-1!==e&&d(e)}),[t.pathname,i]),r.a.createElement(se.a,{position:"fixed",color:"primary",className:e.appBar},r.a.createElement(te.a,{value:i,onChange:function(e,t){console.log({event:e,newValue:t}),d(t)}},r.a.createElement(ae.a,{component:c.b,to:".",label:"Charts",icon:r.a.createElement(re.a,null)}),r.a.createElement(ae.a,{component:c.b,to:"assets-and-reports",label:"Data",icon:r.a.createElement(ie.a,null)}),r.a.createElement(ae.a,{component:c.b,to:"import-export",label:"Export/import",icon:r.a.createElement(ce.a,null)})))},pe=a(313),be=a(317),ge=a(316),ye=a(314),he=a(315),Ae=a(312),Se=function(){var e,t=Object(n.useContext)($e);return r.a.createElement("div",{className:"_2kclh"},r.a.createElement(C.a,{startIcon:r.a.createElement(Ae.a,null),to:"sort",component:c.b,variant:"contained",color:"secondary",size:"small"},"sort"),r.a.createElement(C.a,{to:"create",component:c.b,variant:"contained",color:"secondary",size:"small"},"add"),r.a.createElement(pe.a,{stickyHeader:!0},r.a.createElement(ye.a,null,r.a.createElement(he.a,null,r.a.createElement(ge.a,null,"type"),r.a.createElement(ge.a,null,"name"),r.a.createElement(ge.a,null,"used in"))),r.a.createElement(be.a,null,null===(e=J(t))||void 0===e?void 0:e.map((function(e){var a=H(t).filter((function(t){return t.institutionId===e.id}));return(r.a.createElement(he.a,{hover:!0,key:e.id,component:c.b,to:e.id},r.a.createElement(ge.a,null,e.type),r.a.createElement(ge.a,null,e.name),r.a.createElement(ge.a,null,a.length)))})))))},Oe=a(101),Ie=Object(E.a)({id:"form",initial:"idle",states:{idle:{on:{SUBMIT:"submitting"}},validating:{},submitting:{entry:Object(f.b)((function(e,t){return console.log("e",t,"---context.form.getValues();",e.form.getValues()),console.log("======"),{}})),on:{"":"submitted"}},submitted:{on:{REINIT:"idle"}}}}),xe=function(e){var t,a,l,i=e.storeService,c=Object(n.useContext)($e),u=Object(Oe.b)(),s=Object(d.useMachine)(Ie,{devTools:!0,context:{form:u}}),m=Object(o.a)(s,2),v=m[0],E=m[1];Object(n.useEffect)((function(){v.matches("submitted")&&(i.send("UPDATE_DATA",{actionType:"create",entity:"assetAccounts",data:v.context.form.getValues()}),E("REINIT"))}),[v,E,i]);return r.a.createElement("div",null,r.a.createElement("h1",null,"Asset accounts ",null===(t=H(c))||void 0===t?void 0:t.length),r.a.createElement("form",{onSubmit:u.handleSubmit((function(e){E("SUBMIT")}))},r.a.createElement(B,null,r.a.createElement("thead",null,r.a.createElement(N,null,r.a.createElement(M,{colspan:4}),r.a.createElement(M,null,"Used in # of")),r.a.createElement(N,null,r.a.createElement(M,null,"id"),r.a.createElement(M,null,"asset"),r.a.createElement(M,null,"institution"),r.a.createElement(M,null,"name"),r.a.createElement(M,null,"reports"))),r.a.createElement("tbody",null,r.a.createElement(N,null,r.a.createElement(q,null),r.a.createElement(q,null,r.a.createElement("select",{name:"assetId",ref:u.register({required:"Required"})},null===c||void 0===c?void 0:c.data.assets.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id},e.class," ",e.subclass," ",e.name)})))),r.a.createElement(q,null,r.a.createElement("select",{name:"institutionId",ref:u.register({required:"Required"})},null===c||void 0===c?void 0:c.data.institutions.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id},e.type," ",e.name)})))),r.a.createElement(q,null,r.a.createElement("input",{name:"name",ref:u.register({required:"Required"})}),r.a.createElement("br",null),null===(a=u.errors.name)||void 0===a?void 0:a.message),r.a.createElement(q,null),r.a.createElement(q,null,r.a.createElement("button",{type:"submit"},"Save"))),null===(l=H(c))||void 0===l?void 0:l.map((function(e){var t,a;if(void 0===c)return null;var n=null===c||void 0===c?void 0:c.data.assetAccountStates.filter((function(t){return t.assetAccountId===e.id}));return(r.a.createElement(N,{key:e.id},r.a.createElement(q,null,e.id),r.a.createElement(q,null,null===(t=c.data.assets.find((function(t){return t.id===e.assetId})))||void 0===t?void 0:t.name),r.a.createElement(q,null,null===(a=c.data.institutions.find((function(t){return t.id===e.institutionId})))||void 0===a?void 0:a.name),r.a.createElement(q,null,e.name),r.a.createElement(q,null,n.length),r.a.createElement(q,null,0===n.length&&r.a.createElement("button",{type:"button",onClick:function(){return t=e.id,void i.send({type:"UPDATE_DATA",actionType:"delete",entity:"assetAccounts",data:{id:t}});var t}},"delete"))))}))))))},Te=function(e){var t,a,l,i,c,u=e.storeService,s=Object(n.useContext)($e),m=Object(Oe.b)(),v=Object(d.useMachine)(Ie,{devTools:!0,context:{form:m}}),E=Object(o.a)(v,2),f=E[0],p=E[1];Object(n.useEffect)((function(){f.matches("submitted")&&(u.send("UPDATE_DATA",{actionType:"create",entity:"assets",data:f.context.form.getValues()}),p("REINIT"))}),[f,p,u]);return r.a.createElement("div",null,r.a.createElement("h1",null,"Assets ",null===s||void 0===s?void 0:null===(t=s.data.assets)||void 0===t?void 0:t.length),r.a.createElement("form",{onSubmit:m.handleSubmit((function(e){p("SUBMIT")}))},r.a.createElement(B,null,r.a.createElement("thead",null,r.a.createElement(N,null,r.a.createElement(M,{colspan:5}),r.a.createElement(M,null,"Used in # of")),r.a.createElement(N,null,r.a.createElement(M,null,"ID"),r.a.createElement(M,null,"class"),r.a.createElement(M,null,"subclass"),r.a.createElement(M,null,"name"),r.a.createElement(M,null,"currency"),r.a.createElement(M,null,"asset accounts"))),r.a.createElement("tbody",null,r.a.createElement(N,null,r.a.createElement(q,null),r.a.createElement(q,null,r.a.createElement("select",{name:"class",ref:m.register({required:"Required"})},L.map((function(e){return r.a.createElement("option",{value:e},e)})))),r.a.createElement(q,null,r.a.createElement("input",{name:"subclass",ref:m.register({required:"Required"})}),null===(a=m.errors.subclass)||void 0===a?void 0:a.message),r.a.createElement(q,null,r.a.createElement("input",{name:"name",ref:m.register({required:"Required"})}),r.a.createElement("br",null),null===(l=m.errors.name)||void 0===l?void 0:l.message),r.a.createElement(q,null,r.a.createElement("input",{name:"currency",ref:m.register({required:"Required"})}),r.a.createElement("br",null),null===(i=m.errors.currency)||void 0===i?void 0:i.message),r.a.createElement(q,null),r.a.createElement(q,null,r.a.createElement("button",{type:"submit"},"Save"))),null===s||void 0===s?void 0:null===(c=s.data.assets)||void 0===c?void 0:c.map((function(e){var t,a=null===(t=H(s))||void 0===t?void 0:t.filter((function(t){return t.assetId===e.id}));return r.a.createElement(N,{key:e.id},r.a.createElement(q,null,e.id),r.a.createElement(q,null,e.class),r.a.createElement(q,null,e.subclass),r.a.createElement(q,null,e.name),r.a.createElement(q,null,e.currency),r.a.createElement(q,null,a.length),r.a.createElement(q,null,0===a.length&&r.a.createElement("button",{type:"button",onClick:function(){return t=e.id,void u.send({type:"UPDATE_DATA",actionType:"delete",entity:"assets",data:{id:t}});var t}},"delete")))}))))))},je=(a(222),a(328)),_e=a(318);a(327),a(195);var De,Re=function(){var e=r.a.useState(0),t=Object(o.a)(e,2),a=t[0],n=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(se.a,{position:"sticky"},r.a.createElement(je.a,{value:a,onChange:function(e,t){n(t)},"aria-label":"simple tabs example",variant:"scrollable",scrollButtons:"desktop"},r.a.createElement(_e.a,{label:"Reports",component:c.b,to:"."}),r.a.createElement(_e.a,{label:"Assets",component:c.b,to:"assets"}),r.a.createElement(_e.a,{label:"Institutions",component:c.b,to:"institutions"}),r.a.createElement(_e.a,{label:"Asset accounts",component:c.b,to:"asset-accounts"}))))},we=a(326),Ue=a(320),ke=a(321),Ce=a(86),Fe=Ce.d({date:Ce.b().required("\u0434\u0430\u0442\u0430!"),assetAccountStates:Ce.a().of(Ce.d({balance:Ce.e().required("\u0437\u0430\u043f\u043e\u043b\u043d\u044f\u0439, \u0441\u0443\u043a\u0430"),assetAccountId:Ce.e().required("\u0437\u0430\u043f\u043e\u043b\u043d\u044f\u0439, \u0441\u0443\u043a\u0430")}))}),Be=function(e){var t,a,l,i,o=e.storeService,c=Object(n.useContext)($e),d=Object(u.h)(),s=H(c);if(void 0!==d.reportId){l=null===c||void 0===c?void 0:c.data.reports.find((function(e){return e.id===d.reportId}));var m=null===c||void 0===c?void 0:c.data.assetAccountStates.filter((function(e){var t;return e.reportId===(null===(t=l)||void 0===t?void 0:t.id)}));i=null===s||void 0===s?void 0:s.map((function(e){var t,a=null===m||void 0===m?void 0:m.find((function(t){return t.assetAccountId===e.id}));return void 0!==a?a:{assetAccountId:e.id,reportId:null===(t=l)||void 0===t?void 0:t.id,balance:"0",comment:""}}))}var E=Object(Oe.b)({validationSchema:Fe,defaultValues:{date:(null===(t=l)||void 0===t?void 0:t.datetime)?new Date(l.datetime).toISOString().substr(0,10):(new Date).toISOString().substr(0,10),assetAccountStates:i}}),f=Object(u.g)(),p=(new Date).getTime(),b=j.a.maxBy(j.a.filter(null===c||void 0===c?void 0:c.data.reports,(function(e){return e.datetime<(l?l.datetime:p)})),(function(e){return e.datetime})),g=null===c||void 0===c?void 0:c.data.assetAccountStates.filter((function(e){return e.reportId===(null===b||void 0===b?void 0:b.id)}));return r.a.createElement("div",null,r.a.createElement("h1",null,"Add report"),r.a.createElement("form",{onSubmit:E.handleSubmit((function(e){console.log("=====values",e.date,e),void 0===l?o.send({type:"UPDATE_DATA",actionType:"create",entity:"assetAccountStates",data:e}):o.send({type:"UPDATE_DATA",actionType:"update",entity:"assetAccountStates",data:Object(v.a)({reportId:l.id},e)}),f("/assets-and-reports")}))},r.a.createElement("input",{type:"date",name:"date",ref:E.register}),null===(a=E.errors.date)||void 0===a?void 0:a.message,r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(B,null,r.a.createElement("tbody",null,null===s||void 0===s?void 0:s.map((function(e,t){var a,n,l,i,o,u,d,m,v,f=0===t||s[t].institutionId!==s[t-1].institutionId?r.a.createElement(N,{key:"header".concat(e.id)},r.a.createElement(q,{colspan:2},r.a.createElement("h3",null,null===(a=J(c))||void 0===a?void 0:null===(n=a.find((function(t){return t.id===e.institutionId})))||void 0===n?void 0:n.name))):null,p=(null===g||void 0===g?void 0:null===(l=g.find((function(t){return t.assetAccountId===e.id})))||void 0===l?void 0:l.balance)||0,b=r.a.createElement(N,{key:"data".concat(e.id)},r.a.createElement(q,null,r.a.createElement(Oe.a,{as:we.a,label:e.name,InputLabelProps:{shrink:!0,disableAnimation:!0},name:"assetAccountStates[".concat(t,"].balance"),control:E.control,variant:"outlined",helperText:(null===(i=E.errors.assetAccountStates)||void 0===i?void 0:null===(o=i[t])||void 0===o?void 0:o.balance)?(null===(u=E.errors.assetAccountStates)||void 0===u?void 0:null===(d=u[t])||void 0===d?void 0:d.balance).message:"last balance: ".concat(z(p)),error:Boolean(null===(m=E.errors.assetAccountStates)||void 0===m?void 0:null===(v=m[t])||void 0===v?void 0:v.balance)}),r.a.createElement("input",{type:"hidden",name:"assetAccountStates[".concat(t,"].assetAccountId"),ref:E.register,value:e.id})),r.a.createElement(q,null,r.a.createElement(F.a,{"aria-label":"use last balance",color:"secondary",size:"small",onClick:function(){return E.setValue("assetAccountStates[".concat(t,"].balance"),p)}},r.a.createElement(Ue.a,null))));return r.a.createElement(r.a.Fragment,{key:e.id},f,b)})))),r.a.createElement(C.a,{variant:"contained",color:"primary",size:"large",startIcon:r.a.createElement(ke.a,null),type:"submit"},"Save")))},Ne=Ce.d((De={},Object(m.a)(De,"type",Ce.e().required("required")),Object(m.a)(De,"name",Ce.e().required("required")),Object(m.a)(De,"sortIndex",Ce.c().integer().moreThan(-1,"required posititve number").required("required")),De)),qe=function(e){var t,a,l,i,c,s,m,E=e.storeService,f=Object(u.h)(),p=Object(n.useContext)($e);void 0!==f.institutionId&&(m=null===p||void 0===p?void 0:p.data.institutions.find((function(e){return e.id===f.institutionId})));var b=Object(Oe.b)({validationSchema:Ne,defaultValues:{type:null===(t=m)||void 0===t?void 0:t.type,name:null===(a=m)||void 0===a?void 0:a.name,sortIndex:null===(l=m)||void 0===l?void 0:l.sortIndex}}),g=Object(d.useMachine)(Ie,{devTools:!0,context:{form:b}}),y=Object(o.a)(g,2),h=y[0],A=y[1];Object(n.useEffect)((function(){h.matches("submitted")&&(void 0===m?E.send("UPDATE_DATA",{actionType:"create",entity:"institutions",data:Ne.validateSync(h.context.form.getValues())}):E.send("UPDATE_DATA",{actionType:"update",entity:"institutions",data:Object(v.a)({id:m.id},Ne.validateSync(h.context.form.getValues()))}),A("REINIT"))}),[h,A,E,m]);var S=H(p).filter((function(e){var t;return e.institutionId===(null===(t=m)||void 0===t?void 0:t.id)}));return(r.a.createElement("div",null,r.a.createElement("form",{onSubmit:b.handleSubmit((function(e){console.log("________",e),A("SUBMIT")}))},"Insitution ",null===(i=m)||void 0===i?void 0:i.id,r.a.createElement(B,null,r.a.createElement("thead",null,r.a.createElement(N,null,r.a.createElement(M,{colspan:3}),r.a.createElement(M,null,"Used in # of"),r.a.createElement(M,null)),r.a.createElement(N,null,r.a.createElement(M,null,"ID"),r.a.createElement(M,null,"type"),r.a.createElement(M,null,"name"),r.a.createElement(M,null,"sort index"),r.a.createElement(M,null,"asset accounts"),r.a.createElement(M,null,"action"))),r.a.createElement("tbody",null,r.a.createElement(N,null,r.a.createElement(q,null),r.a.createElement(q,null,r.a.createElement("select",{name:"type",ref:b.register({required:"Required"})},Y.map((function(e){return r.a.createElement("option",{value:e},e)})))),r.a.createElement(q,null,r.a.createElement("input",{name:"name",ref:b.register({required:"Required"})}),null===(c=b.errors.name)||void 0===c?void 0:c.message),r.a.createElement(q,null,r.a.createElement("input",{name:"sortIndex",ref:b.register({required:"Required"})}),null===(s=b.errors.sortIndex)||void 0===s?void 0:s.message),r.a.createElement(q,null,"used in # of asset accounts"," ",S.length,0===S.length&&r.a.createElement("button",{type:"button",onClick:function(){var e,t;console.log("----delete",null===(e=m)||void 0===e?void 0:e.id),E.send({type:"UPDATE_DATA",actionType:"delete",entity:"institutions",data:{id:null===(t=m)||void 0===t?void 0:t.id}})}},"Delete")),r.a.createElement(q,null,r.a.createElement("button",{type:"submit"},"Save"))))))))},Me=a(202),Pe=a(218),Le=a.n(Pe),Ye=a(319),Ve=a(322),We=a(323),ze=a(324),Xe=a(219),Je=a.n(Xe),He=Object(Me.b)((function(e){var t=e.value;return(r.a.createElement(Ve.a,{ContainerComponent:"div"},r.a.createElement(We.a,{primary:t}),r.a.createElement(ze.a,null,r.a.createElement(Je.a,null))))})),Ke=Object(Me.a)((function(e){var t=e.children;return(r.a.createElement(Ye.a,{component:"div"},t))})),Ge=function(e){var t=J(Object(n.useContext)($e)),a=Object(n.useState)(t),l=Object(o.a)(a,2),i=l[0],c=l[1];return r.a.createElement(Ke,{onSortEnd:function(t){var a=Le()(i,t.oldIndex,t.newIndex);c(a),a.forEach((function(t,a){e.storeService.send("UPDATE_DATA",{actionType:"update",entity:"institutions",data:Object(v.a)(Object(v.a)({},t),{},{sortIndex:a})})}))}},i.map((function(e,t){return r.a.createElement(He,{key:"item-".concat(e.id),index:t,value:e.name})})))},Qe=function(e){var t=e.storeService;return(r.a.createElement(r.a.Fragment,null,r.a.createElement(Re,null),r.a.createElement(u.c,null,r.a.createElement(u.a,{path:"institutions",element:r.a.createElement(Se,null)}),r.a.createElement(u.a,{path:"institutions/:institutionId",element:r.a.createElement(qe,{storeService:t})}),r.a.createElement(u.a,{path:"institutions/sort",element:r.a.createElement(Ge,{storeService:t})}),r.a.createElement(u.a,{path:"assets",element:r.a.createElement(Te,{storeService:t})}),r.a.createElement(u.a,{path:"asset-accounts",element:r.a.createElement(xe,{storeService:t})}),r.a.createElement(u.a,{element:r.a.createElement(K,{storeService:t})}),r.a.createElement(u.a,{path:"add-edit-report/:reportId",element:r.a.createElement(Be,{storeService:t})}),r.a.createElement(u.a,{path:"add-edit-report",element:r.a.createElement(Be,{storeService:t})}))))},Ze=function(e){var t=e.state,a=e.send,n=(e.storeService,Object(u.g)());return r.a.createElement("div",null,r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(C.a,{variant:"contained",component:"label",color:"primary",size:"large",onClick:function(){!function(e){var t=new Blob([e],{type:"text/json;charset=UTF-8"}),a=new FileReader;a.onload=function(){var e=document.createElement("a");e.setAttribute("href",a.result),e.setAttribute("download","fintrack.json"),document.body.appendChild(e),e.click()},a.readAsDataURL(t)}(JSON.stringify(t.context.db,null,2))}},"export"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(C.a,{variant:"contained",component:"label",color:"primary",size:"large"},"import",r.a.createElement("div",{style:{display:"none "}},r.a.createElement("input",{type:"file",onChange:function(e){var t=new FileReader;t.onload=function(e){console.log(e.target.result);var t=JSON.parse(e.target.result);a("LOAD_FROM_INPUT",{data:t}),n("/")},t.readAsText(e.target.files[0])}}))))},$e=r.a.createContext(void 0),et=function(){var e,t=Object(d.useMachine)(x,{devTools:!0}),a=Object(o.a)(t,3),n=a[0],l=a[1],i=a[2];return r.a.createElement($e.Provider,{value:null===(e=n.context.db)||void 0===e?void 0:e.getState()},r.a.createElement(c.a,null,r.a.createElement(r.a.Fragment,null,r.a.createElement(s.a,null),r.a.createElement("div",{className:"_3QqL3"},r.a.createElement("div",{className:"_2KOUX"},r.a.createElement(u.c,null,r.a.createElement(u.a,{element:r.a.createElement(ee,null)}),r.a.createElement(u.a,{path:"assets-and-reports/*",element:r.a.createElement(Qe,{storeService:i})}),r.a.createElement(u.a,{path:"import-export",element:r.a.createElement(Ze,{state:n,send:l,storeService:i})}))),r.a.createElement(fe,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(et,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[235,1,3]]]);
//# sourceMappingURL=main.98d58837.chunk.js.map