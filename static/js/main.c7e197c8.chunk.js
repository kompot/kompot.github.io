(this["webpackJsonpfintrack-client-only"]=this["webpackJsonpfintrack-client-only"]||[]).push([[0],{325:function(e,t,n){e.exports=n(471)},330:function(e,t,n){},331:function(e,t,n){},467:function(e,t,n){},471:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),l=n(25),i=n.n(l),o=(n(330),n(18)),c=n(28),u=n(13),d=n(69),s=n(559),m=(n(331),n(24)),v=n(52),E=n(164),f=n(10),p=n(128),b=n(278),g=n(154),y=n.n(g),h=n(155),S=n.n(h),A=Object(E.a)({id:"fetch",initial:"idle",context:{url:"",data:null,error:null,retries:0,maxRetries:3},states:{idle:{on:{FETCH:"loading"}},loading:{invoke:{src:"fetch",onDone:{target:"success",actions:["setData","notifyData",Object(f.r)("LOADED")]},onError:{target:"failure",actions:["setError","notifyError"]}}},success:{on:{REFETCH:{target:"loading",actions:"resetRetries"}}},failure:{on:{"":{target:"fatal",cond:"canNotRetry"},RETRY:{target:"loading",actions:"incrementRetries"}}},fatal:{type:"final"}}},{guards:{canNotRetry:function(e){return e.retries===e.maxRetries}},actions:{setData:Object(f.b)({data:function(e,t){return t.data}}),notifyData:function(){console.log("-----notifydata")},setError:Object(f.b)({error:function(e,t){return t.data}}),notifyError:function(){},incrementRetries:Object(f.b)({retries:function(e){return e.retries+1}})},services:{fetch:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return fetch(e.url).then((function(e){return e.json()})).then((function(e){return e}))}))}}),O=Object(b.a)("ABCDEFGHJKLMNPQRSTUVWXYZ123456789",6),I=function(e){var t=new Date(e);return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())},T=Object(E.a)({key:"store",initial:"idle",context:{db:null,urlDataToSave:void 0,fetchRef:null},entry:Object(f.b)({fetchRef:function(){return Object(p.c)(A.withContext({url:"/data.json",maxRetries:4,data:null,error:null,retries:0}),{name:"fetch"})}}),states:{idle:{entry:Object(f.b)((function(e,t){if(null!==e.db)return{};var n=null!==sessionStorage.getItem("fintrack_db")?JSON.parse(sessionStorage.getItem("fintrack_db")):null,a=y()(new S.a(""));return a.setState(n),{db:a}})),on:{LOAD:{actions:Object(f.q)("FETCH",{to:"fetch"})},LOADED:"loaded",UPDATE_DATA:"updating_data",LOAD_FROM_INPUT:"loaded_from_input"}},loaded:{entry:Object(f.b)((function(e,t){void 0!==e.urlDataToSave&&window.URL.revokeObjectURL(e.urlDataToSave);var n=y()(new S.a(""));return n.setState(e.fetchRef._state.context.data),{db:n,urlDataToSave:void 0}})),on:{SAVE:"saving",UPDATE_DATA:"updating_data"}},loaded_from_input:{entry:Object(f.b)((function(e,t){console.log("=========loaded_from_input",t);var n=y()(new S.a(""));return n.setState(t.data),sessionStorage.setItem("fintrack_db",JSON.stringify(t.data)),{db:n,urlDataToSave:void 0}})),on:{SAVE:"saving",UPDATE_DATA:"updating_data",LOAD_FROM_INPUT:"loaded_from_input"}},saving:{entry:Object(f.b)((function(e,t){var n,a;return console.log("-=====ctx.data",null===(n=e.db)||void 0===n?void 0:n.getState()),{urlDataToSave:window.URL.createObjectURL(new Blob([JSON.stringify(null===(a=e.db)||void 0===a?void 0:a.getState(),null,2)],{type:"text/plain"}))}})),on:{SAVED:"loaded"}},updating_data:{entry:Object(f.b)((function(e,t){var n;if("create"===t.actionType)if("assetAccountStates"===t.entity){var a,r=O();null===(a=e.db)||void 0===a||a.get("data").get("reports").push({id:r,datetime:I(t.data.date)}).write(),t.data.assetAccountStates.forEach((function(t){var n;null===(n=e.db)||void 0===n||n.get("data").get("assetAccountStates").push(Object(v.a)(Object(v.a)({},t),{},{reportId:r})).write()}))}else{var l,i;null===(l=e.db)||void 0===l||null===(i=l.get("data"))||void 0===i||i.get(t.entity).push(Object(v.a)({id:O()},t.data)).write()}else if("update"===t.actionType){if("exchangeRates"===t.entity){var o,c=null===(o=e.db)||void 0===o?void 0:o.get("data").get("exchangeRates"),u=null===c||void 0===c?void 0:c.find((function(e){return e.reportId===t.data.report.id}));if(void 0!==(null===u||void 0===u?void 0:u.value()))u.get("data").set(t.data.asset.id,t.data.value).write();else{var d={id:O(),reportId:t.data.report.id,data:Object(m.a)({},t.data.asset.id,t.data.value)};null===c||void 0===c||c.push(d).write()}}if("assetAccountStates"===t.entity){var s,E,f=null===(s=e.db)||void 0===s?void 0:s.get("data").get("reports"),p=null===f||void 0===f?void 0:f.find((function(e){return e.id===t.data.reportId}));null===p||void 0===p||p.set("datetime",I(t.data.date)).write();var b=[];null===(E=e.db)||void 0===E||E.get("data").get("assetAccountStates").forEach((function(e){var n;e.reportId===t.data.reportId&&(e.balance=null===(n=t.data.assetAccountStates.find((function(t){return t.assetAccountId===e.assetAccountId})))||void 0===n?void 0:n.balance,b.push(e.assetAccountId))})).write(),t.data.assetAccountStates.filter((function(e){return!b.includes(e.assetAccountId)})).forEach((function(n){var a;null===(a=e.db)||void 0===a||a.get("data").get("assetAccountStates").push(Object(v.a)(Object(v.a)({},n),{},{reportId:t.data.reportId})).write()}))}if("institutions"===t.entity){var g,y=null===(g=e.db)||void 0===g?void 0:g.get("data").get("institutions"),h=null===y||void 0===y?void 0:y.find((function(e){return e.id===t.data.id}));null===h||void 0===h||h.assign(t.data).write()}}else{if("delete"!==t.actionType)throw new Error("How did you end up here?");var S,A,T,x,R,j;"institutions"===t.entity&&(null===(S=e.db)||void 0===S||S.get("data").get("institutions").remove((function(e){return e.id===t.data.id})).write());"assets"===t.entity&&(null===(A=e.db)||void 0===A||A.get("data").get("assets").remove((function(e){return e.id===t.data.id})).write());"assetAccounts"===t.entity&&(null===(T=e.db)||void 0===T||T.get("data").get("assetAccounts").remove((function(e){return e.id===t.data.id})).write());"reports"===t.entity&&(null===(x=e.db)||void 0===x||x.get("data").get("reports").remove((function(e){return e.id===t.data.id})).write(),null===(R=e.db)||void 0===R||R.get("data").get("assetAccountStates").remove((function(e){return e.reportId===t.data.id})).write(),null===(j=e.db)||void 0===j||j.get("data").get("exchangeRates").remove((function(e){return e.reportId===t.data.id})).write())}return sessionStorage.setItem("fintrack_db",JSON.stringify(null===(n=e.db)||void 0===n?void 0:n.getState())),{}})),on:{"":"idle"}}}}),x=n(195),R=n(545),j=n(546),D=n(271),C=n(39),_=n.n(C),w=n(542),U=n(270),k=n.n(U),B=(n(467),function(e){var t=e.children;return(r.a.createElement("table",{className:"_3-1r7"},t))}),N=function(e){var t=e.children;return(r.a.createElement("tr",{className:"_3Mjlo"},t))},q=function(e){var t=e.children,n=e.colspan;return(r.a.createElement("td",{className:"zX0YF",colSpan:n},t))},F=function(e){var t=e.children,n=e.colspan;return(r.a.createElement("th",{className:"_1rfFa",colSpan:n},t))};function L(e,t,n,a){return null===e||void 0===e?void 0:e.data.assetAccountStates.filter((function(e){return e.reportId===t.id})).reduce((function(r,l){var i,o=e.data.assetAccounts.find((function(e){return e.id===l.assetAccountId})),c=e.data.assets.find((function(e){return e.id===o.assetId}));if(void 0!==a&&!a(c))return Math.round(r);var u=null===(i=e.data.exchangeRates.find((function(e){return e.reportId===t.id})))||void 0===i?void 0:i.data,d=function(e,t,n,a){if(void 0===t)return 0;var r="CURRENCY"===n.class,l=r?n:null===e||void 0===e?void 0:e.data.assets.find((function(e){return"CURRENCY"===e.class&&e.name===n.currency})),i=1;if(l.currency!==a){var o=null===e||void 0===e?void 0:e.data.assets.find((function(e){return"CURRENCY"===e.class&&e.name===a}));if(void 0!==o){var c=t[o.id];i=null!==c?parseFloat(c):0}}return 0===i?0:parseFloat(t[l.id]||"0")/i*(r?1:parseFloat(t[n.id]||"0"))}(e,u,c,n)*parseFloat(l.balance);return Math.round(d+r)}),0)}function P(e){return _.a.sortBy(null===e||void 0===e?void 0:e.data.institutions,(function(e){return e.sortIndex||e.name}))}function M(e){var t;return null===(t=P(e))||void 0===t?void 0:t.flatMap((function(t){return _.a.sortBy(null===e||void 0===e?void 0:e.data.assetAccounts.filter((function(e){return e.institutionId===t.id})),(function(e){return e.name}))}))}var Y=function(e){var t,n=Object(a.useContext)(Ce),l=M(n);if(void 0===l)return null;var i=_.a.sortBy(null===n||void 0===n?void 0:n.data.reports,(function(e){return-1*e.datetime})),o=null===n||void 0===n?void 0:n.data.assets;i[0];return r.a.createElement("div",null,r.a.createElement("h1",null,"Your net worth is..."),r.a.createElement(w.a,{color:"primary","aria-label":"add",component:c.b,to:"add-edit-report",style:{margin:0,top:"auto",right:20,bottom:80,left:"auto",position:"fixed"}},r.a.createElement(k.a,null)),r.a.createElement(B,null,r.a.createElement("thead",null,r.a.createElement(N,null,r.a.createElement(F,null),null===(t=P(n))||void 0===t?void 0:t.map((function(e){return r.a.createElement(F,{colspan:l.filter((function(t){return t.institutionId===e.id})).length},e.name)}))),r.a.createElement(N,null,r.a.createElement(F,null,"date"),l.map((function(e){return r.a.createElement(F,null,e.name)})),r.a.createElement(F,null,"Total in RUB"),r.a.createElement(F,null,"Total in USD"),r.a.createElement(F,null,"Total in EUR"))),r.a.createElement("tbody",null,null===i||void 0===i?void 0:i.map((function(t){var a=null===n||void 0===n?void 0:n.data.assetAccountStates.filter((function(e){return e.reportId===t.id}));return(r.a.createElement(N,{key:t.id},r.a.createElement(q,null,r.a.createElement(c.b,{to:"add-edit-report/".concat(t.id)},new Date(t.datetime).toISOString().substr(0,10))),l.map((function(e){var t=null===a||void 0===a?void 0:a.find((function(t){return t.assetAccountId===e.id}));return(r.a.createElement(q,null,null===t||void 0===t?void 0:t.balance))})),r.a.createElement(q,null,L(n,t,"RUB")),r.a.createElement(q,null,L(n,t,"USD")),r.a.createElement(q,null,L(n,t,"EUR")),r.a.createElement(q,null,r.a.createElement("button",{onClick:function(){var n;n=t.id,e.storeService.send("UPDATE_DATA",{actionType:"delete",entity:"reports",data:{id:n}})}},"delete"))))})))),r.a.createElement("h2",null,"Exchange rates"),r.a.createElement(B,null,r.a.createElement("thead",null,r.a.createElement(N,null,r.a.createElement(F,null,"date"),null===o||void 0===o?void 0:o.map((function(e){return r.a.createElement(F,null,e.class," ",e.subclass," ",e.name," in ",e.currency)})))),r.a.createElement("tbody",null,null===i||void 0===i?void 0:i.map((function(t){var a=null===n||void 0===n?void 0:n.data.exchangeRates.find((function(e){return e.reportId===t.id}));return(r.a.createElement(N,{key:t.id},r.a.createElement(q,null,new Date(t.datetime).toISOString().substr(0,10)),null===o||void 0===o?void 0:o.map((function(n){var l,i=null===a||void 0===a?void 0:null===(l=a.data)||void 0===l?void 0:l[n.id];return r.a.createElement(q,null,r.a.createElement("input",{style:{width:50},defaultValue:i,onChange:function(a){return function(t,n,a){console.log("_________value",t,n,a),e.storeService.send({type:"UPDATE_DATA",actionType:"update",entity:"exchangeRates",data:{value:t,asset:n,report:a}})}(a.target.value,n,t)}}))}))))})))))},V=function(){var e=Object(a.useContext)(Ce),t=Object(c.c)(),n=Object(o.a)(t,2),l=n[0],i=(n[1],["USD","EUR","RUB"]),u=l.get("yearsBack"),d={start:Object(D.a)(Object(R.a)(new Date,-1*parseInt(null!==u&&void 0!==u?u:"0",10)),-2),end:new Date},s=null===e||void 0===e?void 0:e.data.reports.filter((function(e){return null===u||Object(j.a)(e.datetime,d)})),m=i.map((function(t){var n=_.a.compact(null===s||void 0===s?void 0:s.map((function(n){var a=new Date(n.datetime),r=a.getUTCFullYear()+"-"+_.a.padStart(String(a.getUTCMonth()+1),2,"0")+"-"+a.getUTCDate();return console.log("=====d.getUTCMonth() === 1",1===a.getUTCMonth(),L(e,n,t),r),{x:r,y:(L(e,n,t,(function(e){return e.name===t}))||0).toFixed(0)}})));return console.log("====allReportsInCurrency",n),{id:t,data:n||[]}})),v=i.map((function(t){var n=_.a.compact(null===s||void 0===s?void 0:s.map((function(n){var a=new Date(n.datetime),r=a.getUTCFullYear()+"-"+_.a.padStart(String(a.getUTCMonth()+1),2,"0")+"-"+a.getUTCDate();return console.log("=====d.getUTCMonth() === 1",1===a.getUTCMonth(),L(e,n,t),r),{x:r,y:(100*(L(e,n,t,(function(e){return e.name===t}))/L(e,n,t)||0)).toFixed(0)}})));return console.log("====allReportsInCurrency",n),{id:t,data:n||[]}}));console.log({data1:m});var E=function(e){return r.a.createElement(x.a,{animate:!1,data:[m[e]],margin:{top:50,right:110,bottom:50,left:60},xScale:{type:"time",format:"%Y-%m-%d"},xFormat:"time:%Y-%m-%d",yScale:{type:"linear",min:"auto",max:"auto",stacked:!0},axisTop:null,axisRight:null,axisBottom:{format:"%Y %m",tickValues:"every 4 months",legend:"\u0432\u0440\u0435\u043c\u044f",legendOffset:-12},axisLeft:{orient:"left",tickSize:5,tickPadding:5,tickRotation:0},pointSize:0,pointColor:{theme:"background"},pointBorderWidth:2,pointBorderColor:{from:"serieColor"},pointLabel:"y",pointLabelYOffset:-12,enableSlices:"x",useMesh:!0,legends:[{anchor:"bottom-right",direction:"column",justify:!1,translateX:100,translateY:0,itemsSpacing:0,itemDirection:"left-to-right",itemWidth:80,itemHeight:20,itemOpacity:.75,symbolSize:12,symbolShape:"circle",symbolBorderColor:"rgba(0, 0, 0, .5)",effects:[{on:"hover",style:{itemBackground:"rgba(0, 0, 0, .03)",itemOpacity:1}}]}],sliceTooltip:function(e){var t=e.slice;return console.log("------slice",t),r.a.createElement("div",{style:{background:"white",padding:"9px 12px",border:"1px solid #ccc"}},r.a.createElement("div",null,t.points[0].data.xFormatted),t.points.map((function(e){return r.a.createElement("div",{key:e.id,style:{color:e.serieColor,padding:"3px 0"}},r.a.createElement("strong",null,e.serieId)," ",e.data.yFormatted)})))}})};return(r.a.createElement("div",{style:{height:300}},r.a.createElement("h1",null,"Charts"),r.a.createElement("h6",null,r.a.createElement(c.b,{to:"?yearsBack=1"},"1 year")," |"," ",r.a.createElement(c.b,{to:"?yearsBack=2"},"2 year")," | ",r.a.createElement(c.b,{to:"."},"all")),r.a.createElement("div",{style:{width:"100%",height:300,display:"flex"}},r.a.createElement("div",{style:{width:"33%",height:300}},E(0)),r.a.createElement("div",{style:{width:"33%",height:300}},E(1)),r.a.createElement("div",{style:{width:"33%",height:300}},E(2))),r.a.createElement(x.a,{animate:!1,data:v,margin:{top:50,right:110,bottom:50,left:60},xScale:{type:"time",format:"%Y-%m-%d"},xFormat:"time:%Y-%m-%d",yScale:{type:"linear",min:"auto",max:"auto"},axisTop:null,axisRight:null,axisBottom:{format:"%Y %m",tickValues:"every 4 months",legend:"\u0432\u0440\u0435\u043c\u044f",legendOffset:-12},axisLeft:{orient:"left",tickSize:5,tickPadding:5,tickRotation:0,legend:"%",legendOffset:-50,legendPosition:"middle"},pointSize:4,pointColor:{theme:"background"},pointBorderWidth:2,pointBorderColor:{from:"serieColor"},pointLabel:"y",pointLabelYOffset:-12,enableSlices:"x",useMesh:!0,legends:[{anchor:"bottom-right",direction:"column",justify:!1,translateX:100,translateY:0,itemsSpacing:0,itemDirection:"left-to-right",itemWidth:80,itemHeight:20,itemOpacity:.75,symbolSize:12,symbolShape:"circle",symbolBorderColor:"rgba(0, 0, 0, .5)",effects:[{on:"hover",style:{itemBackground:"rgba(0, 0, 0, .03)",itemOpacity:1}}]}],sliceTooltip:function(e){var t=e.slice;return console.log("------slice",t),r.a.createElement("div",{style:{background:"white",padding:"9px 12px",border:"1px solid #ccc"}},r.a.createElement("div",null,t.points[0].data.xFormatted),t.points.map((function(e){return r.a.createElement("div",{key:e.id,style:{color:e.serieColor,padding:"3px 0"}},r.a.createElement("strong",null,e.serieId)," ",e.data.yFormatted,"%")})))}})))},z=n(549),H=n(550),J=n(272),W=n.n(J),X=n(273),K=n.n(X),G=n(274),Q=n.n(G),Z=n(547),$=n(564),ee=n(548),te=Object(Z.a)((function(e){return Object($.a)({text:{padding:e.spacing(2,2,0)},paper:{paddingBottom:50},list:{marginBottom:e.spacing(2)},subheader:{backgroundColor:e.palette.background.paper},appBar:{top:"auto",bottom:0},grow:{flexGrow:1},fabButton:{position:"absolute",zIndex:1,top:-30,left:0,right:0,margin:"0 auto"},fullList:{width:"auto"}})})),ne=_.a.values({0:"/",1:"/assets-and-reports",2:"/import-export"}),ae=function(e,t){return"/"===e?"/"===t:t.startsWith(e)},re=function(){var e=te(),t=Object(u.f)(),n=r.a.useState(void 0),l=Object(o.a)(n,2),i=l[0],d=l[1];return Object(a.useEffect)((function(){ne.some((function(e){return ae(e,t.pathname)}))||d(void 0);var e=ne.findIndex((function(e){return ae(e,t.pathname)}));-1!==e&&d(e)}),[t.pathname,i]),r.a.createElement(ee.a,{position:"fixed",color:"primary",className:e.appBar},r.a.createElement(z.a,{value:i,onChange:function(e,t){console.log({event:e,newValue:t}),d(t)}},r.a.createElement(H.a,{component:c.b,to:".",label:"Charts",icon:r.a.createElement(W.a,null)}),r.a.createElement(H.a,{component:c.b,to:"assets-and-reports",label:"Data",icon:r.a.createElement(K.a,null)}),r.a.createElement(H.a,{component:c.b,to:"import-export",label:"Export/import",icon:r.a.createElement(Q.a,null)})))},le=n(551),ie=n(555),oe=n(554),ce=n(552),ue=n(553),de=function(){var e,t=Object(a.useContext)(Ce);return r.a.createElement("div",{className:"_2kclh"},r.a.createElement(le.a,{stickyHeader:!0},r.a.createElement(ce.a,null,r.a.createElement(ue.a,null,r.a.createElement(oe.a,null,"type"),r.a.createElement(oe.a,null,"name"),r.a.createElement(oe.a,null,"used in"))),r.a.createElement(ie.a,null,null===(e=P(t))||void 0===e?void 0:e.map((function(e){var n=M(t).filter((function(t){return t.institutionId===e.id}));return(r.a.createElement(ue.a,{hover:!0,key:e.id,component:c.b,to:e.id},r.a.createElement(oe.a,null,e.type),r.a.createElement(oe.a,null,e.name),r.a.createElement(oe.a,null,n.length)))})))))},se=n(57),me=Object(E.a)({id:"form",initial:"idle",states:{idle:{on:{SUBMIT:"submitting"}},validating:{},submitting:{entry:Object(f.b)((function(e,t){return console.log("e",t,"---context.form.getValues();",e.form.getValues()),console.log("======"),{}})),on:{"":"submitted"}},submitted:{on:{REINIT:"idle"}}}}),ve=function(e){var t,n,l,i=e.storeService,c=Object(a.useContext)(Ce),u=Object(se.b)(),s=Object(d.useMachine)(me,{devTools:!0,context:{form:u}}),m=Object(o.a)(s,2),v=m[0],E=m[1];Object(a.useEffect)((function(){v.matches("submitted")&&(i.send("UPDATE_DATA",{actionType:"create",entity:"assetAccounts",data:v.context.form.getValues()}),E("REINIT"))}),[v,E,i]);return r.a.createElement("div",null,r.a.createElement("h1",null,"Asset accounts ",null===(t=M(c))||void 0===t?void 0:t.length),r.a.createElement("form",{onSubmit:u.handleSubmit((function(e){E("SUBMIT")}))},r.a.createElement(B,null,r.a.createElement("thead",null,r.a.createElement(N,null,r.a.createElement(F,{colspan:4}),r.a.createElement(F,null,"Used in # of")),r.a.createElement(N,null,r.a.createElement(F,null,"id"),r.a.createElement(F,null,"asset"),r.a.createElement(F,null,"institution"),r.a.createElement(F,null,"name"),r.a.createElement(F,null,"reports"))),r.a.createElement("tbody",null,r.a.createElement(N,null,r.a.createElement(q,null),r.a.createElement(q,null,r.a.createElement("select",{name:"assetId",ref:u.register({required:"Required"})},null===c||void 0===c?void 0:c.data.assets.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id},e.class," ",e.subclass," ",e.name)})))),r.a.createElement(q,null,r.a.createElement("select",{name:"institutionId",ref:u.register({required:"Required"})},null===c||void 0===c?void 0:c.data.institutions.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id},e.type," ",e.name)})))),r.a.createElement(q,null,r.a.createElement("input",{name:"name",ref:u.register({required:"Required"})}),r.a.createElement("br",null),null===(n=u.errors.name)||void 0===n?void 0:n.message),r.a.createElement(q,null),r.a.createElement(q,null,r.a.createElement("button",{type:"submit"},"Save"))),null===(l=M(c))||void 0===l?void 0:l.map((function(e){var t,n;if(void 0===c)return null;var a=null===c||void 0===c?void 0:c.data.assetAccountStates.filter((function(t){return t.assetAccountId===e.id}));return(r.a.createElement(N,{key:e.id},r.a.createElement(q,null,e.id),r.a.createElement(q,null,null===(t=c.data.assets.find((function(t){return t.id===e.assetId})))||void 0===t?void 0:t.name),r.a.createElement(q,null,null===(n=c.data.institutions.find((function(t){return t.id===e.institutionId})))||void 0===n?void 0:n.name),r.a.createElement(q,null,e.name),r.a.createElement(q,null,a.length),r.a.createElement(q,null,0===a.length&&r.a.createElement("button",{type:"button",onClick:function(){return t=e.id,void i.send({type:"UPDATE_DATA",actionType:"delete",entity:"assetAccounts",data:{id:t}});var t}},"delete"))))}))))))},Ee=["CURRENCY","CRYPTO_CURRENCY","SECURITY","VALUABLE_ASSET","PRECIOUS_METAL"],fe=["BANK","BROKER","PERSON","PHYSICAL_LOCATION","E-WALLET","OTHER"],pe=function(e){var t,n,l,i,c,u=e.storeService,s=Object(a.useContext)(Ce),m=Object(se.b)(),v=Object(d.useMachine)(me,{devTools:!0,context:{form:m}}),E=Object(o.a)(v,2),f=E[0],p=E[1];Object(a.useEffect)((function(){f.matches("submitted")&&(u.send("UPDATE_DATA",{actionType:"create",entity:"assets",data:f.context.form.getValues()}),p("REINIT"))}),[f,p,u]);return r.a.createElement("div",null,r.a.createElement("h1",null,"Assets ",null===s||void 0===s?void 0:null===(t=s.data.assets)||void 0===t?void 0:t.length),r.a.createElement("form",{onSubmit:m.handleSubmit((function(e){p("SUBMIT")}))},r.a.createElement(B,null,r.a.createElement("thead",null,r.a.createElement(N,null,r.a.createElement(F,{colspan:5}),r.a.createElement(F,null,"Used in # of")),r.a.createElement(N,null,r.a.createElement(F,null,"ID"),r.a.createElement(F,null,"class"),r.a.createElement(F,null,"subclass"),r.a.createElement(F,null,"name"),r.a.createElement(F,null,"currency"),r.a.createElement(F,null,"asset accounts"))),r.a.createElement("tbody",null,r.a.createElement(N,null,r.a.createElement(q,null),r.a.createElement(q,null,r.a.createElement("select",{name:"class",ref:m.register({required:"Required"})},Ee.map((function(e){return r.a.createElement("option",{value:e},e)})))),r.a.createElement(q,null,r.a.createElement("input",{name:"subclass",ref:m.register({required:"Required"})}),null===(n=m.errors.subclass)||void 0===n?void 0:n.message),r.a.createElement(q,null,r.a.createElement("input",{name:"name",ref:m.register({required:"Required"})}),r.a.createElement("br",null),null===(l=m.errors.name)||void 0===l?void 0:l.message),r.a.createElement(q,null,r.a.createElement("input",{name:"currency",ref:m.register({required:"Required"})}),r.a.createElement("br",null),null===(i=m.errors.currency)||void 0===i?void 0:i.message),r.a.createElement(q,null),r.a.createElement(q,null,r.a.createElement("button",{type:"submit"},"Save"))),null===s||void 0===s?void 0:null===(c=s.data.assets)||void 0===c?void 0:c.map((function(e){var t,n=null===(t=M(s))||void 0===t?void 0:t.filter((function(t){return t.assetId===e.id}));return r.a.createElement(N,{key:e.id},r.a.createElement(q,null,e.id),r.a.createElement(q,null,e.class),r.a.createElement(q,null,e.subclass),r.a.createElement(q,null,e.name),r.a.createElement(q,null,e.currency),r.a.createElement(q,null,n.length),r.a.createElement(q,null,0===n.length&&r.a.createElement("button",{type:"button",onClick:function(){return t=e.id,void u.send({type:"UPDATE_DATA",actionType:"delete",entity:"assets",data:{id:t}});var t}},"delete")))}))))))},be=(n(279),n(562)),ge=n(557);n(561),n(556);var ye,he=function(){var e=r.a.useState(0),t=Object(o.a)(e,2),n=t[0],a=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(ee.a,{position:"sticky"},r.a.createElement(be.a,{value:n,onChange:function(e,t){a(t)},"aria-label":"simple tabs example",variant:"scrollable",scrollButtons:"desktop"},r.a.createElement(ge.a,{label:"Reports",component:c.b,to:"."}),r.a.createElement(ge.a,{label:"Assets",component:c.b,to:"assets"}),r.a.createElement(ge.a,{label:"Institutions",component:c.b,to:"institutions"}),r.a.createElement(ge.a,{label:"Asset accounts",component:c.b,to:"asset-accounts"}))))},Se=n(560),Ae=n(44),Oe=Ae.d({date:Ae.b().required("\u0434\u0430\u0442\u0430!"),assetAccountStates:Ae.a().of(Ae.d({balance:Ae.e().required("\u0437\u0430\u043f\u043e\u043b\u043d\u044f\u0439, \u0441\u0443\u043a\u0430"),assetAccountId:Ae.e().required("\u0437\u0430\u043f\u043e\u043b\u043d\u044f\u0439, \u0441\u0443\u043a\u0430")}))}),Ie=function(e){var t,n,l,i,o,c=e.storeService,d=Object(a.useContext)(Ce),s=Object(u.h)(),m=M(d);if(void 0!==s.reportId){i=null===d||void 0===d?void 0:d.data.reports.find((function(e){return e.id===s.reportId}));var E=null===d||void 0===d?void 0:d.data.assetAccountStates.filter((function(e){var t;return e.reportId===(null===(t=i)||void 0===t?void 0:t.id)}));o=null===m||void 0===m?void 0:m.map((function(e){var t,n=null===E||void 0===E?void 0:E.find((function(t){return t.assetAccountId===e.id}));return void 0!==n?n:{assetAccountId:e.id,reportId:null===(t=i)||void 0===t?void 0:t.id,balance:"0",comment:""}}))}var f=Object(se.b)({validationSchema:Oe,defaultValues:{date:(null===(t=i)||void 0===t?void 0:t.datetime)?new Date(i.datetime).toISOString().substr(0,10):(new Date).toISOString().substr(0,10),assetAccountStates:o}}),p=Object(u.g)(),b=null===(n=_.a.maxBy(null===d||void 0===d?void 0:d.data.reports,(function(e){return e.datetime})))||void 0===n?void 0:n.id,g=null===d||void 0===d?void 0:d.data.assetAccountStates.filter((function(e){return e.reportId===b}));return r.a.createElement("div",null,r.a.createElement("h1",null,"Add report"),r.a.createElement("form",{onSubmit:f.handleSubmit((function(e){console.log("=====values",e.date,e),void 0===i?c.send({type:"UPDATE_DATA",actionType:"create",entity:"assetAccountStates",data:e}):c.send({type:"UPDATE_DATA",actionType:"update",entity:"assetAccountStates",data:Object(v.a)({reportId:i.id},e)}),p("/")}))},r.a.createElement("input",{type:"date",name:"date",ref:f.register}),null===(l=f.errors.date)||void 0===l?void 0:l.message,r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(B,null,r.a.createElement("thead",null,r.a.createElement(N,null,r.a.createElement(q,null,"New balance"),r.a.createElement(q,null,"Prev balance"))),r.a.createElement("tbody",null,null===m||void 0===m?void 0:m.map((function(e,t){var n,a,l,i,o,c,u,s,v,E,p=0===t||m[t].institutionId!==m[t-1].institutionId?r.a.createElement(N,{key:"header".concat(e.id)},r.a.createElement(q,{colspan:2},r.a.createElement("h3",null,null===(n=P(d))||void 0===n?void 0:null===(a=n.find((function(t){return t.id===e.institutionId})))||void 0===a?void 0:a.name))):null,b=r.a.createElement(N,{key:"data".concat(e.id)},r.a.createElement(q,null,r.a.createElement(se.a,{as:Se.a,label:e.name,InputLabelProps:{shrink:!0,disableAnimation:!0},name:"assetAccountStates[".concat(t,"].balance"),control:f.control,variant:"outlined",helperText:(null===(l=f.errors.assetAccountStates)||void 0===l?void 0:null===(i=l[t])||void 0===i?void 0:i.balance)?(null===(o=f.errors.assetAccountStates)||void 0===o?void 0:null===(c=o[t])||void 0===c?void 0:c.balance).message:null===g||void 0===g?void 0:null===(u=g.find((function(t){return t.assetAccountId===e.id})))||void 0===u?void 0:u.balance,error:Boolean(null===(s=f.errors.assetAccountStates)||void 0===s?void 0:null===(v=s[t])||void 0===v?void 0:v.balance)}),r.a.createElement("input",{type:"hidden",name:"assetAccountStates[".concat(t,"].assetAccountId"),ref:f.register,value:e.id})),r.a.createElement(q,null,null===g||void 0===g?void 0:null===(E=g.find((function(t){return t.assetAccountId===e.id})))||void 0===E?void 0:E.balance));return r.a.createElement(r.a.Fragment,{key:e.id},p,b)})))),r.a.createElement("button",{type:"submit"},"Submit")))},Te=Ae.d((ye={},Object(m.a)(ye,"type",Ae.e().required("required")),Object(m.a)(ye,"name",Ae.e().required("required")),Object(m.a)(ye,"sortIndex",Ae.c().integer().moreThan(-1,"required posititve number").required("required")),ye)),xe=function(e){var t,n,l,i,c,s,m=e.storeService,E=Object(u.h)(),f=Object(a.useContext)(Ce);void 0!==E.institutionId&&(s=null===f||void 0===f?void 0:f.data.institutions.find((function(e){return e.id===E.institutionId})));var p=Object(se.b)({validationSchema:Te,defaultValues:{type:null===(t=s)||void 0===t?void 0:t.type,name:null===(n=s)||void 0===n?void 0:n.name,sortIndex:null===(l=s)||void 0===l?void 0:l.sortIndex}}),b=Object(d.useMachine)(me,{devTools:!0,context:{form:p}}),g=Object(o.a)(b,2),y=g[0],h=g[1];Object(a.useEffect)((function(){y.matches("submitted")&&(void 0===s?m.send("UPDATE_DATA",{actionType:"create",entity:"institutions",data:Te.validateSync(y.context.form.getValues())}):m.send("UPDATE_DATA",{actionType:"update",entity:"institutions",data:Object(v.a)({id:s.id},Te.validateSync(y.context.form.getValues()))}),h("REINIT"))}),[y,h,m,s]);var S=M(f).filter((function(e){var t;return e.institutionId===(null===(t=s)||void 0===t?void 0:t.id)}));return(r.a.createElement("div",null,r.a.createElement("form",{onSubmit:p.handleSubmit((function(e){console.log("________",e),h("SUBMIT")}))},"Insitution ",E.institutionId,r.a.createElement(B,null,r.a.createElement("thead",null,r.a.createElement(N,null,r.a.createElement(F,{colspan:3}),r.a.createElement(F,null,"Used in # of"),r.a.createElement(F,null)),r.a.createElement(N,null,r.a.createElement(F,null,"ID"),r.a.createElement(F,null,"type"),r.a.createElement(F,null,"name"),r.a.createElement(F,null,"sort index"),r.a.createElement(F,null,"asset accounts"),r.a.createElement(F,null,"action"))),r.a.createElement("tbody",null,r.a.createElement(N,null,r.a.createElement(q,null),r.a.createElement(q,null,r.a.createElement("select",{name:"type",ref:p.register({required:"Required"})},fe.map((function(e){return r.a.createElement("option",{value:e},e)})))),r.a.createElement(q,null,r.a.createElement("input",{name:"name",ref:p.register({required:"Required"})}),null===(i=p.errors.name)||void 0===i?void 0:i.message),r.a.createElement(q,null,r.a.createElement("input",{name:"sortIndex",ref:p.register({required:"Required"})}),null===(c=p.errors.sortIndex)||void 0===c?void 0:c.message),r.a.createElement(q,null,"used in # of asset accounts"," ",S.length,0===S.length&&r.a.createElement("button",{type:"button",onClick:function(){var e,t;console.log("----delete",null===(e=s)||void 0===e?void 0:e.id),m.send({type:"UPDATE_DATA",actionType:"delete",entity:"institutions",data:{id:null===(t=s)||void 0===t?void 0:t.id}})}},"Delete")),r.a.createElement(q,null,r.a.createElement("button",{type:"submit"},"Save"))))))))},Re=function(e){var t=e.storeService;return(r.a.createElement(r.a.Fragment,null,r.a.createElement(he,null),r.a.createElement(u.c,null,r.a.createElement(u.a,{path:"institutions",element:r.a.createElement(de,null)}),r.a.createElement(u.a,{path:"institutions/:institutionId",element:r.a.createElement(xe,{storeService:t})}),r.a.createElement(u.a,{path:"assets",element:r.a.createElement(pe,{storeService:t})}),r.a.createElement(u.a,{path:"asset-accounts",element:r.a.createElement(ve,{storeService:t})}),r.a.createElement(u.a,{element:r.a.createElement(Y,{storeService:t})}),r.a.createElement(u.a,{path:"add-edit-report/:reportId",element:r.a.createElement(Ie,{storeService:t})}),r.a.createElement(u.a,{path:"add-edit-report",element:r.a.createElement(Ie,{storeService:t})}))))},je=n(558),De=function(e){var t=e.state,n=e.send,a=(e.storeService,Object(u.g)());return r.a.createElement("div",null,r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(je.a,{variant:"contained",component:"label",color:"primary",size:"large",onClick:function(){!function(e){var t=new Blob([e],{type:"text/json;charset=UTF-8"}),n=new FileReader;n.onload=function(){var e=document.createElement("a");e.setAttribute("href",n.result),e.setAttribute("download","fintrack.json"),document.body.appendChild(e),e.click()},n.readAsDataURL(t)}(JSON.stringify(t.context.db,null,2))}},"export"),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(je.a,{variant:"contained",component:"label",color:"primary",size:"large"},"import",r.a.createElement("div",{style:{display:"none "}},r.a.createElement("input",{type:"file",onChange:function(e){var t=new FileReader;t.onload=function(e){console.log(e.target.result);var t=JSON.parse(e.target.result);n("LOAD_FROM_INPUT",{data:t}),a("/")},t.readAsText(e.target.files[0])}}))))},Ce=r.a.createContext(void 0),_e=function(){var e,t=Object(d.useMachine)(T,{devTools:!0}),n=Object(o.a)(t,3),a=n[0],l=n[1],i=n[2];return r.a.createElement(Ce.Provider,{value:null===(e=a.context.db)||void 0===e?void 0:e.getState()},r.a.createElement(c.a,null,r.a.createElement(r.a.Fragment,null,r.a.createElement(s.a,null),r.a.createElement("div",{className:"_3QqL3"},r.a.createElement("div",{className:"_2KOUX"},r.a.createElement(u.c,null,r.a.createElement(u.a,{element:r.a.createElement(V,null)}),r.a.createElement(u.a,{path:"assets-and-reports/*",element:r.a.createElement(Re,{storeService:i})}),r.a.createElement(u.a,{path:"import-export",element:r.a.createElement(De,{state:a,send:l,storeService:i})}))),r.a.createElement(re,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(_e,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[325,1,2]]]);
//# sourceMappingURL=main.c7e197c8.chunk.js.map